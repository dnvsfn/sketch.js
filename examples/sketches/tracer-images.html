<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>2011-08-15 D</title>
<link rel="stylesheet" href="/stylesheets/style.css">
<script src="sketch.js"></script>
<script src="/javascripts/images.js"></script>
</head>
<body>
<canvas></canvas>
<script type="text/javascript">
Sketch.create(function(){
  
	var IMAGE_WIDTH = 160,
		IMAGE_HEIGHT = 160,
		images = [];

	var Pic = function (location, image_source_size, image_dest_size, image) {
		
		this.location = location;
		this.acceleration = new Point();
		this.velocity = new Point();
		
		this.image = image;
		this.image_resized = null;
		this.source_size = image_source_size;
		this.size = image_dest_size;
		
		this.resizeImage();
	};
	
	Pic.prototype = {
		
		resizeImage: function() {
			
			var s = this.source_size, 
				n = new Size(), 
				crop = new Point();
			
			if (s.width > s.height) {
				n = new Size(s.height, s.height);
				// crop = new Point(s.width/2, 0);
			
			} else if (s.width < s.height) {
				n = new Size(s.width, s.height);
				// crop = new Point(0, s.height/2);
			}
			
			$c.context.drawImage(
				this.image, 
				crop.x, 
				crop.y, 
				n.width, 
				n.height, 
				0, 
				0, 
				this.size.width, 
				this.size.height
			);
			
			this.image_resized = $c.context.getImageData(0, 0, IMAGE_WIDTH, IMAGE_HEIGHT);
			$c.context.clearRect(0, 0, IMAGE_WIDTH, IMAGE_HEIGHT);
			
		},
		update: function() {

			var acc = new Point(
				Math.round(Math.random() * 1) > 0 ? 0.1 : -0.1,
				Math.round(Math.random() * 1) > 0 ? 0.1 : -0.1
			);

			this.acceleration = acc;
			
			this.velocity.add(this.acceleration);
			this.location.add(this.velocity);
			this.acceleration = new Point();
			this.velocity.limit(10);
		},
		bounds: function() {
			var l = this.location,
				s = this.size;
			
			if (l.x > $c.WIDTH + s.width) {
				l.x = -s.width;
			} else if (l.x < -s.width) {
				l.x = $c.WIDTH + s.width;
			}
			
			if (l.y < -s.height) {
				l.y = $c.HEIGHT;
			} else if (l.y > $c.HEIGHT) {
				l.y = -s.height;
			}
		},
		draw: function() {
			$c.context.putImageData(this.image_resized, this.location.x, this.location.y);
		},
		run: function () {
			this.bounds();
			this.update();
			this.draw();
		}
	};


	function setup() {
		
		for (var i = 0; i < images_src.length; i++) {
			
			var img = new Image(), 
				img_src = images_src[i];
			
			img.id = i;
			img.onload = function() {
				
				var loc = new Point(
					(40 * this.id) + (IMAGE_WIDTH * this.id) + 40,
					100
					// Math.random() * $c.WIDTH,
					// Math.random() * $c.HEIGHT
				);
				
				var p = new Pic(loc, 
					new Size(this.width, this.height), 
					new Size(IMAGE_WIDTH, IMAGE_HEIGHT), 
					this
				);
				images.push(p);
				
				p.run();
				
				return true;
			};
			img.src = img_src.url;
		};
	};
	
	$c.clear_screen = false;
	
	function draw () {
		
		background('rgba(255,255,255,0.07)');
		
		for (var i = 0; i < images.length; i++) {
			var p = images[i];
			p.run();
		};

	};
	
	Sketch.run(setup,draw);
});
</script>
</body>
</html>
