<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>2011-08-15 C</title>
<link rel="stylesheet" href="/stylesheets/style.css">
<script src="sketch.js"></script>
<script src="/javascripts/images.js"></script>
</head>
<body>
<canvas></canvas>
<script type="text/javascript">
Sketch.create(function () {
	
	var images = [];
		IMAGE_WIDTH = 80,
		IMAGE_HEIGHT = IMAGE_WIDTH;

	var Pic = function (location, size, speed, image) {
		this.location = location;
		this.velocity = new Point();
		this.size = size;
		this.speed = speed;
		this.image = image;	
	};
	
	Pic.prototype = {
		update: function() {
			
			var acc = new Point(
				Math.cos($c.frame / 100) + this.speed,
				Math.sin($c.frame / 100) + this.speed
			);
			
			var dir = new Point(
				map($c.mouse.x, 0, $c.WIDTH, -2.0, 2.0),
				map($c.mouse.y, 0, $c.HEIGHT, -2.0, 2.0)
			);
			
			this.velocity.add(acc);
			this.velocity.add(dir);
			
			this.location.add(this.velocity);
			
			this.velocity = new Point();
		},
		bounds: function() {
			var l = this.location,
				s = this.size;
			
			if(l.x > $c.WIDTH + s.width){
				l.x = -s.width;
			} else if (l.x < -s.width){
				l.x = $c.WIDTH + s.width;
			}
			
			if(l.y < -s.height){
				l.y = $c.HEIGHT;
			} else if (l.y > $c.HEIGHT) {
				l.y = -s.height;
			}
		},
		draw: function() {
			$c.context.drawImage(
				this.image, 
				this.location.x, 
				this.location.y, 
				this.size.width, 
				this.size.height
			);
		},
		run: function () {
			this.bounds();
			this.update();
			this.draw();
		}
	};
	


	function setup(){
		for (var i=0; i < images_src.length; i++) {
			
			var p, s, img, speed;
			
			p = new Point(
				Math.random() * $c.WIDTH,
				Math.random() * $c.HEIGHT
			);
			
			s = new Size(
				map(i, 0, images_src.length, 10, IMAGE_WIDTH),
				map(i, 0, images_src.length, 10, IMAGE_HEIGHT)
			);
			
			speed = map(i, images_src.length, 0, 0.1, 1.0);
			
			img = new Image();
			img.onload = function(){
				$c.context.drawImage(this, p.x, p.y, s.width, s.height);
			}
			img.src = images_src[i].url;
			
			var pic = new Pic(p, s, speed, img);
			images.push(pic);
		};
	};

	function draw(){
		for (var i=0; i < images.length; i++) {
			var img = images[i];
			img.run();
		};
	};
	
	Sketch.run(setup, draw);
	
});
</script>
</body>
</html>
