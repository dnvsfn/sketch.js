<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>2011-08-19 A</title>
<link rel="stylesheet" href="/stylesheets/style.css">
<script src="sketch.js"></script>
</head>
<body>
<canvas></canvas>
<script type="text/javascript">
Sketch.create(function () {
	
	var show_grid = true,
		BOX_COUNT = 20,
		BOX_MIN_SIZE = 20,
		BOX_MAX_SIZE = 40,
		boxes = [],
		speed = 0.05,
		grid;
	
	window.onkeydown = function (event) {
		console.log('keyCode: ' + event.keyCode);
		
		if (event.keyCode == 67) {
			$c.clear_screen ^= true;
		}
		
		if (event.keyCode == 82) {
			setRandom();
		}
	};
	
	var Box = function (location, size) {
		this.location = location ? location : new Point();
		this.size = size ? size : random(BOX_MIN_SIZE, BOX_MAX_SIZE); // random size min and max
		this.velocity = new Point();
		this.angle = 0;
		this.rotateSpeed = 0.005;
		this.fillColor = "rgba(255,0,0,0.6)";
	};

	Box.prototype = {
		update: function () {
			this.checkBounds();
			
			// if ($c.frame < 10) {
			// 	console.log(typeof this.destination);
			// }
			
			// console.log('frame: ' + $c.frame);
			
			if (typeof this.destination !== "undefined") {
				var vector = Point.sub(this.destination, this.location);
				vector = vector.mult(speed);
				this.location.add(vector);
			}
			
			var acc = new Point(random(-speed,speed), random(-speed,speed));
			
			this.velocity.add(acc);
			this.velocity.limit(5);
			this.location.add(this.velocity);
			
			this.velocity = new Point();
		},
		draw: function () {
			// this.angle += 0.005;
			
			// $c.context.save();
			// $c.context.translate(this.location.x, this.location.y);
			// $c.context.rotate(this.angle);
			// $c.context.translate(-(this.size/2), -(this.size/2));
			// $c.context.fillStyle = this.fillColor;
			// $c.context.fillRect(0, 0, this.size, this.size);
			// $c.context.fillStyle = 'rgba(0,0,0,0.1)';
			// $c.context.fillRect(2, 2, this.size, this.size);
			// $c.context.restore();
			
			var l = this.location,
				s = this.size,
				a = this.angle;
			
			// console.log('l: ' + l.toString() + ' | s: ' + s.toString() + ' | ' + a);
			
			push();
			translate(l.x, l.y);
			rotate(this.angle);
			translate(-(s/2), -(s/2));
			
			// opacity(0.3);
			stroke('white');
			strokeSize(10);
			// fill('black');
			square(1, 1, s);
			
			// opacity(1);
			stroke('black');
			strokeSize(8);
			// fill('red');
			square(0, 0, s);
			pop();
			
			this.angle+=this.rotateSpeed;
		},
		run: function () {
			this.update();
			this.draw();
		},
		checkBounds: function () {
			var l = this.location,
				s = this.size;
			
			if (l.x > $c.WIDTH + s) {
				l.x = -s;
			} else if (l.x < -s) {
				l.x = $c.WIDTH + s;
			}
			if (l.y > $c.HEIGHT + s) {
				l.y = -s;
			} else if (l.y < -s) {
				l.y = $c.WIDTH + s;
			}
		}
	};
	
	function setDestination (point) {
		for (var i=0; i < boxes.length; i++) {
			var b = boxes[i];
			b.destination = point;
		};
	};
	
	function setRandom (point) {
		for (var i=0; i < boxes.length; i++) {
			var b = boxes[i];
			b.destination = Point.random();
		};
	};
	
	$c.canvas.onmousedown = function (event) {
		setDestination($c.mouse);
		// grid.draw();
	};
	
	function setup () {
		
		grid = new Grid($c.WIDTH, $c.HEIGHT);
		
		for (var i=0; i < BOX_COUNT; i++) {
			var loc = Point.random();
			
			var b = new Box(Point.random(), (i+1) * 20);
			b.rotateSpeed = i/1000;
			boxes.push(b);
		};
		
		$c.clear_screen = false;
	};
	
	function draw () {
		// grid.draw();
		
		background('rgba(255,0,0,0.06)');
		
		for (var i=0; i < boxes.length; i++) {
			var b = boxes[i];
			b.run();
			// console.log(b.destination.x + ',' + b.destination.y);
		};
		
		// console.log("frame: " + $c.frame);
	};
	
	// draw();
	
	Sketch.run(setup, draw);
	
});

</script>
</body>
</html>
