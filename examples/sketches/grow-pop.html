<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>2011-08-27 D</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <script src="sketch.js"></script>
</head>
<body>
<canvas></canvas>
<script type="text/javascript">
Sketch.create(function () { 
	
	var Orb = Particle.extend({
		update: function () {
			var acc = Point.random(-1,1);
			this.lastLocation = new Point(this.location);
			this.velocity.add(acc);
			this.location.add(this.velocity);
			// this.velocity.limit(10);
			
			this.velocity.normalize();
			this.velocity.mult(3);
			
			if (this.radius < 1) {
				this.removed = true;
				this.end();
			} else {
				this.radius -= this.radius / 100;
			}
		},
		draw: function () {
			// push();
			// opacity(0.2);
			// fill(this.color);
			// stroke(false);
			// stroke('black');
			// strokeSize(2);
			// console.log(this.radius);
			// circle(this.location, this.radius);
			// pop();
			
			stroke(Color.frame(0.25,0.5,0.75));
			beginPath();
			strokeSize(this.radius);
			moveTo(this.lastLocation.x, this.lastLocation.y);
			lineTo(this.location.x, this.location.y);
			endPath();
		},
		run: function () {
			if (this.removed==false) {
				// console.log('run()');
				this.checkBounds();
				this.update();
				this.draw();
			}
		},
		end: function () {
			
			var l = new Point(this.location);
			
			// console.log(l+'');
			
			for (var i=0; i < 6; i++) {

				fill(Color.frame(0.25,0.5,0.75));
				stroke(false);
				circle(
					Point.random(
						l.x-20,
						l.y-20,
						l.x+20,
						l.y+20
					),
					random(1, 10)
				);
				
			};
			
		}
	});
	
	var orbs = [];
 	
	function addOrb (l, s) {
		orbs.push(
			new Orb({
				location: l, 
				velocity: new Point(),
				radius: s || 40,
				removed: false,
				// color: Color.frame()
				// color: Color.frame(0.9, 0.2, 0.2)
				color: Color.frame(0.25, 0.50, 0.75)
			})
		);
	};

	$c.mouseDrag(function(){
		addOrb($c.mouse);
	});
	
	$c.clear_screen = false;
	
	var grid = new Grid($c.WIDTH, $c.HEIGHT);
	// var p = $c.center;
	
	$c.play(function () {
		
		if ($c.frame==1) {
			grid.draw();
		}
		
		background('rgba(0,0,0,0.004)');
		
		if ($c.frame%10==0) {
			addOrb(new Point(Math.cos($c.frame/1000) * $c.WIDTH, $c.center.y));
			
			// p.add(Point.random(-10,10));
		}
		
		for (var i=0; i < orbs.length; i++) {
			var o = orbs[i];
			o.run();
		};
		
		push();
		opacity(0.02);
		// background(Color.frame(0.8, 0.6, 0.3));
		pop();
	});
	
});
</script>
</body>
</html>
